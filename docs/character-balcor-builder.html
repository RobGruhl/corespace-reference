<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Balcor - Character Builder</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Reusing same CSS from Wade builder */
        .character-header {
            background: linear-gradient(135deg, rgba(83, 168, 182, 0.2), rgba(233, 69, 96, 0.2));
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .character-header h1 {
            margin: 0 0 10px 0;
            color: #e94560;
        }

        .character-description {
            color: #ccc;
            margin-bottom: 15px;
        }

        .base-stats {
            display: flex;
            gap: 15px;
            font-size: 1em;
            flex-wrap: wrap;
        }

        .stat {
            background: rgba(83, 168, 182, 0.2);
            padding: 8px 12px;
            border-radius: 5px;
        }

        .stat.special {
            background: rgba(243, 156, 18, 0.2);
            border: 1px solid #f39c12;
        }

        .class-selector {
            margin-top: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
        }

        .class-selector label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #53a8b6;
        }

        .class-selector select {
            width: 100%;
            max-width: 300px;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #53a8b6;
            border-radius: 5px;
            color: #eee;
            font-size: 1em;
            cursor: pointer;
        }

        .skill-point-budget {
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.2), rgba(52, 152, 219, 0.2));
            border: 2px solid #2ecc71;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .budget-display {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .budget-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .budget-label {
            font-size: 0.85em;
            color: #aaa;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .budget-value {
            font-size: 2em;
            font-weight: bold;
            color: #2ecc71;
        }

        .budget-value.zero {
            color: #e74c3c;
        }

        .budget-separator {
            font-size: 2em;
            color: #666;
        }

        .budget-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn-secondary {
            background: rgba(52, 152, 219, 0.3);
            border: 2px solid #3498db;
            color: #3498db;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        .btn-secondary:hover {
            background: rgba(52, 152, 219, 0.5);
        }

        .btn-danger {
            background: rgba(231, 76, 60, 0.3);
            border: 2px solid #e74c3c;
            color: #e74c3c;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        .btn-danger:hover {
            background: rgba(231, 76, 60, 0.5);
        }

        .passive-summary, .reaction-summary {
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .passive-summary {
            background: rgba(155, 89, 182, 0.15);
            border: 2px solid #9b59b6;
        }

        .passive-summary h2 {
            color: #9b59b6;
            margin-top: 0;
        }

        .reaction-summary {
            background: rgba(230, 126, 34, 0.15);
            border: 2px solid #e67e22;
        }

        .reaction-summary h2 {
            color: #e67e22;
            margin-top: 0;
        }

        .passive-item, .reaction-item {
            padding: 12px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
            border-left: 4px solid;
        }

        .passive-item {
            border-left-color: #9b59b6;
        }

        .reaction-item {
            border-left-color: #e67e22;
        }

        .reaction-trigger {
            font-style: italic;
            color: #aaa;
            margin-bottom: 5px;
        }

        .trigger-label {
            text-transform: uppercase;
            font-size: 0.8em;
            font-weight: bold;
            color: #e67e22;
        }

        .empty-state {
            color: #888;
            font-style: italic;
            text-align: center;
            padding: 20px;
        }

        .skill-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .skill-card {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid #53a8b6;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s;
        }

        .skill-card.inactive {
            opacity: 0.4;
            filter: grayscale(0.7);
        }

        .skill-card.max-level {
            border-color: #2ecc71;
            box-shadow: 0 0 15px rgba(46, 204, 113, 0.3);
        }

        .skill-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .skill-name {
            font-size: 1.3em;
            color: #53a8b6;
            margin: 0;
        }

        .skill-category {
            font-size: 0.8em;
            color: #888;
            text-transform: uppercase;
        }

        .inherent-badge {
            background: linear-gradient(135deg, #f39c12, #f1c40f);
            color: #000;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75em;
            font-weight: bold;
            text-transform: uppercase;
        }

        .investment-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
            padding: 15px;
            background: rgba(83, 168, 182, 0.1);
            border-radius: 5px;
        }

        .investment-controls button {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: 2px solid #53a8b6;
            background: rgba(83, 168, 182, 0.2);
            color: #53a8b6;
            font-size: 1.5em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .investment-controls button:hover:not(:disabled) {
            background: rgba(83, 168, 182, 0.4);
            transform: scale(1.1);
        }

        .investment-controls button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .investment-display {
            flex: 1;
            text-align: center;
        }

        .investment-label {
            display: block;
            font-size: 0.8em;
            color: #888;
            margin-bottom: 5px;
        }

        .investment-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #53a8b6;
        }

        .investment-max {
            font-size: 0.9em;
            color: #666;
        }

        .effective-level {
            text-align: center;
            padding: 10px;
            background: rgba(46, 204, 113, 0.1);
            border-radius: 5px;
            margin-bottom: 15px;
        }

        .effective-label {
            font-size: 0.8em;
            color: #aaa;
        }

        .effective-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #2ecc71;
            margin: 0 5px;
        }

        .effective-max {
            font-size: 0.9em;
            color: #666;
        }

        .skill-levels {
            border-top: 1px solid rgba(83, 168, 182, 0.3);
            padding-top: 15px;
        }

        .skill-level {
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 5px;
            border-left: 4px solid #53a8b6;
            background: rgba(83, 168, 182, 0.1);
            display: none;
        }

        .skill-level.active {
            display: block;
        }

        .level-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: bold;
            margin-bottom: 8px;
            background: #53a8b6;
            color: #000;
        }

        .level-badge.free {
            background: linear-gradient(135deg, #f39c12, #f1c40f);
        }

        .level-description {
            color: #ddd;
            line-height: 1.5;
            margin: 0;
        }

        .reaction-details {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .reaction-details .trigger {
            font-style: italic;
            color: #aaa;
        }

        .reaction-details .effect {
            color: #ddd;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: #1a1a2e;
            border: 2px solid #53a8b6;
            border-radius: 8px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
        }

        .modal-content h2 {
            margin-top: 0;
            color: #e94560;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: flex-end;
        }

        @media (max-width: 768px) {
            .skill-grid {
                grid-template-columns: 1fr;
            }

            .base-stats {
                flex-direction: column;
                gap: 10px;
            }

            .budget-display {
                flex-direction: column;
                align-items: flex-start;
            }
        }

        @media print {
            .class-selector, .budget-actions, .investment-controls {
                display: none;
            }

            .skill-card.inactive {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><a href="index.html">‚ö° CORE SPACE ‚ö°</a></h1>
            <div class="tagline">Balcor - Character Builder</div>
        </header>

        <div class="breadcrumb">
            <a href="index.html">Home</a>
            <span>‚Ä∫</span>
            <span>Balcor Builder</span>
        </div>

        <a href="index.html" class="back-btn">‚Üê Back to Hub</a>

        <!-- Character Header -->
        <div class="character-header">
            <h1>Balcor</h1>
            <p class="character-description">Skilled Nerind'ar engineer with modified prosthetic arm. Considerably taller and stronger than humans, prefers unarmed combat. Timid by nature but fierce when crew is in danger.</p>
            <div class="base-stats">
                <span class="stat">‚ù§Ô∏è Health: 5</span>
                <span class="stat special">‚öîÔ∏è Physical Attack: 3 (unarmed)</span>
                <span class="stat special">üõ°Ô∏è Armor: 1 (natural)</span>
                <span class="stat special">üèîÔ∏è Large Size: 1</span>
            </div>

            <div class="class-selector">
                <label for="class-select">Class Card:</label>
                <select id="class-select" onchange="changeClass()">
                    <option value="marine">Marine</option>
                    <option value="support">Support</option>
                    <option value="machine">Machine</option>
                </select>
            </div>
        </div>

        <!-- Skill Point Budget -->
        <div class="skill-point-budget">
            <div class="budget-display">
                <div class="budget-item">
                    <span class="budget-label">Available</span>
                    <span class="budget-value" id="available-points">2</span>
                </div>
                <div class="budget-separator">/</div>
                <div class="budget-item">
                    <span class="budget-label">Total</span>
                    <span class="budget-value" id="total-points">2</span>
                </div>
                <div class="budget-item">
                    <span class="budget-label">Spent</span>
                    <span class="budget-value" id="spent-points">0</span>
                </div>
            </div>

            <div class="budget-actions">
                <button class="btn-secondary" onclick="addSkillPoints()">+Add Points (Level Up)</button>
                <button class="btn-danger" onclick="resetAllSkills()">‚ü≤ Reset All</button>
            </div>
        </div>

        <!-- Passive Skills Summary -->
        <div class="section">
            <div class="passive-summary">
                <h2>üîÆ Passive Skills (Always Active)</h2>
                <div id="passive-list"></div>
                <div id="passive-empty" class="empty-state">
                    No passive skills active yet. Passive skills will appear as you invest in skills.
                </div>
            </div>
        </div>

        <!-- Reaction Skills Summary -->
        <div class="section">
            <div class="reaction-summary">
                <h2>‚ö° Reaction Skills (Triggered Abilities)</h2>
                <div id="reaction-list"></div>
                <div id="reaction-empty" class="empty-state">
                    No reaction skills active yet. Reaction skills will appear as you invest in skills.
                </div>
            </div>
        </div>

        <!-- Skill Cards -->
        <div class="section">
            <h2>Skills</h2>
            <div class="skill-grid" id="skill-grid"></div>
        </div>

        <footer>
            <div class="guide-links">
                <a href="index.html" class="guide-link">‚Üê Back to Hub</a>
                <a href="character-balcor.html" class="guide-link">View Old Tracker</a>
            </div>
        </footer>
    </div>

    <!-- Modals -->
    <div id="class-change-modal" class="modal">
        <div class="modal-content">
            <h2>‚ö†Ô∏è Change Class?</h2>
            <p id="modal-message"></p>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="cancelClassChange()">Cancel</button>
                <button class="btn-danger" onclick="confirmClassChange()">Change Class</button>
            </div>
        </div>
    </div>

    <div id="add-points-modal" class="modal">
        <div class="modal-content">
            <h2>Add Skill Points</h2>
            <p>Current total: <strong id="current-total"></strong> points</p>
            <p>How many points to add?</p>
            <div style="display: flex; gap: 10px; margin: 15px 0;">
                <button class="btn-secondary" onclick="addPoints(1)">+1</button>
                <button class="btn-secondary" onclick="addPoints(2)">+2</button>
                <button class="btn-secondary" onclick="addPoints(3)">+3</button>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="closeAddPointsModal()">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // Game data
        const GAME_DATA = {
            character: {
                id: 'balcor',
                name: 'Balcor',
                startingPoints: 2,
                inherentSkills: {
                    'brutalAssault': 2
                }
            },
            classes: {
                marine: {
                    name: 'Marine',
                    skills: {
                        kata: 2, brutalAssault: 3, walkItOff: 3, onslaught: 3, stubborn: 3
                    }
                },
                support: {
                    name: 'Support',
                    skills: {
                        kata: 2, walkItOff: 3, onslaught: 3, stubborn: 3, impervious: 3, training: 3
                    }
                },
                machine: {
                    name: 'Machine',
                    skills: {
                        impervious: 3
                    }
                }
            },
            skillInfo: {
                brutalAssault: {
                    name: 'Brutal Assault',
                    category: 'Close Assault Skills',
                    levels: {
                        1: [{ type: 'active', desc: 'Make a Close Assault action using only your base ability with one extra combat die. If target survives lay it prone.' }],
                        2: [{ type: 'active', desc: 'Choose a character you are engaged with that is no bigger than you and throw them. Move them into any square within short range and LoS. They suffer no attacks of opportunity from this move. They suffer a two dice attack, rolling an additional die if a wall or other terrain piece prevented them from being thrown the full distance. Then lay them prone.' }]
                    }
                },
                kata: {
                    name: 'Kata',
                    category: 'Close Assault Skills',
                    levels: {
                        1: [{ type: 'active', desc: 'Use when making a close assault attack. Add 2 dice to the attack.' }],
                        2: [{ type: 'active', desc: 'Use when making a close assault attack. Add 3 dice to the attack.' }]
                    }
                },
                walkItOff: {
                    name: 'Walk It Off',
                    category: 'Endurance Skills',
                    levels: {
                        1: [{ type: 'active', desc: 'Restore 1 Health.' }],
                        2: [{ type: 'reaction', trigger: 'After being targeted with an attack', effect: 'Reduce damage sustained by 2.' }],
                        3: [{ type: 'reaction', trigger: 'After being defeated', effect: 'You are no longer defeated ‚Äì restore 1 Health, Stand Up, and you may then make a Move action.' }]
                    }
                },
                onslaught: {
                    name: 'Onslaught',
                    category: 'Endurance Skills',
                    levels: {
                        1: [{ type: 'reaction', trigger: 'After scoring one or more hits on an enemy in close assault', effect: 'Make another Close Assault action.' }],
                        2: [{ type: 'reaction', trigger: 'After scoring one or more hits on an enemy with any attack', effect: 'Make a Move if you wish, and then make another Close Assault action.' }],
                        3: [{ type: 'active', desc: 'Use during a Move action. You may ignore attacks of opportunity during this Move, and you may make a close assault attack against each enemy you come into contact with while moving.' }]
                    }
                },
                stubborn: {
                    name: 'Stubborn',
                    category: 'Endurance Skills',
                    levels: {
                        1: [{ type: 'active', desc: 'Make a Move action.' }],
                        2: [{ type: 'active', desc: 'Make a Move action followed by an Assault action.' }],
                        3: [{ type: 'reaction', trigger: 'After being targeted with an attack', effect: 'Ignore all hits scored, and then make a Move action and an Assault action in any order.' }]
                    }
                },
                impervious: {
                    name: 'Impervious',
                    category: 'Endurance Skills',
                    levels: {
                        1: [{ type: 'reaction', trigger: 'When another rule or Skill causes you to lose any actions or miss your next turn', effect: 'Ignore the effect.' }],
                        2: [{ type: 'active', desc: 'Consider your physical armour value to be 2 higher than it currently is until the end of the round.' }],
                        3: [{ type: 'active', desc: 'Restore 1 Health. This may take you above your starting level as long as there is space on your dashboard, for this game only. In addition, you may not take any damage, be Knocked Back, or be affected by any rule that causes you to lose actions or miss your turn until the end of the round after the current one.' }]
                    }
                },
                training: {
                    name: 'Training',
                    category: 'Vocational Skills',
                    levels: {
                        1: [{ type: 'active', desc: 'Use after taking an action. Another Trader in your crew within short range and LoS immediately makes the same action for free.' }],
                        2: [{ type: 'active', desc: 'Advancement Phase: Add one Career Point to any other Trader in your Crew (level 1-2 only).' }],
                        3: [{ type: 'active', desc: 'Advancement Phase: Add one Career Point to any two Traders in your Crew. One can be at any level; the other is level 1-2 only.' }]
                    }
                }
            }
        };

        // State
        let currentClass = 'support';
        let pendingClass = null;
        let saveData = {
            classId: 'support',
            totalSkillPoints: 2,
            investments: {},
            spentPoints: 0,
            remainingPoints: 2
        };

        // Initialize
        window.addEventListener('DOMContentLoaded', () => {
            loadSaveData();
            renderSkillGrid();
            updateBudgetDisplay();
            updateSummaries();
        });

        // Save/Load
        function loadSaveData() {
            const saved = localStorage.getItem('corespace-balcor-builder');
            if (saved) {
                saveData = JSON.parse(saved);
                currentClass = saveData.classId;
                document.getElementById('class-select').value = currentClass;
            }
        }

        function saveSaveData() {
            localStorage.setItem('corespace-balcor-builder', JSON.stringify(saveData));
        }

        // Class Management
        function changeClass() {
            const newClass = document.getElementById('class-select').value;
            if (newClass === currentClass) return;

            if (saveData.spentPoints > 0) {
                pendingClass = newClass;
                const modal = document.getElementById('class-change-modal');
                const message = document.getElementById('modal-message');
                message.innerHTML = `
                    <p>Changing your class will refund all invested skill points.</p>
                    <p><strong>Current investments:</strong></p>
                    <ul>
                        ${Object.entries(saveData.investments)
                            .map(([skill, level]) => `<li>${GAME_DATA.skillInfo[skill].name}: ${level} points</li>`)
                            .join('')}
                    </ul>
                    <p><strong>Refund:</strong> ${saveData.spentPoints} skill points</p>
                `;
                modal.classList.add('show');
            } else {
                applyClassChange(newClass);
            }
        }

        function confirmClassChange() {
            applyClassChange(pendingClass);
            document.getElementById('class-change-modal').classList.remove('show');
        }

        function cancelClassChange() {
            document.getElementById('class-select').value = currentClass;
            pendingClass = null;
            document.getElementById('class-change-modal').classList.remove('show');
        }

        function applyClassChange(newClass) {
            saveData.classId = newClass;
            saveData.investments = {};
            saveData.spentPoints = 0;
            saveData.remainingPoints = saveData.totalSkillPoints;
            currentClass = newClass;
            saveSaveData();
            renderSkillGrid();
            updateBudgetDisplay();
            updateSummaries();
        }

        // Skill Investment
        function incrementSkill(skillId) {
            const inherent = GAME_DATA.character.inherentSkills[skillId] || 0;
            const currentInvestment = saveData.investments[skillId] || 0;
            const classMax = GAME_DATA.classes[currentClass].skills[skillId];
            const maxInvestable = Math.min(3, classMax) - inherent;

            if (currentInvestment >= maxInvestable) {
                alert('Skill at maximum level!');
                return;
            }

            if (saveData.remainingPoints < 1) {
                alert('Not enough skill points!');
                return;
            }

            saveData.investments[skillId] = currentInvestment + 1;
            saveData.spentPoints++;
            saveData.remainingPoints--;
            saveSaveData();
            renderSkillCard(skillId);
            updateBudgetDisplay();
            updateSummaries();
        }

        function decrementSkill(skillId) {
            const currentInvestment = saveData.investments[skillId] || 0;
            if (currentInvestment === 0) return;

            saveData.investments[skillId] = currentInvestment - 1;
            if (saveData.investments[skillId] === 0) {
                delete saveData.investments[skillId];
            }
            saveData.spentPoints--;
            saveData.remainingPoints++;
            saveSaveData();
            renderSkillCard(skillId);
            updateBudgetDisplay();
            updateSummaries();
        }

        // Skill Points Management
        function addSkillPoints() {
            document.getElementById('current-total').textContent = saveData.totalSkillPoints;
            document.getElementById('add-points-modal').classList.add('show');
        }

        function addPoints(amount) {
            saveData.totalSkillPoints += amount;
            saveData.remainingPoints += amount;
            saveSaveData();
            updateBudgetDisplay();
            closeAddPointsModal();
        }

        function closeAddPointsModal() {
            document.getElementById('add-points-modal').classList.remove('show');
        }

        function resetAllSkills() {
            if (!confirm('Reset all skills to zero? This will refund all spent points. This cannot be undone.')) {
                return;
            }
            saveData.investments = {};
            saveData.spentPoints = 0;
            saveData.remainingPoints = saveData.totalSkillPoints;
            saveSaveData();
            renderSkillGrid();
            updateBudgetDisplay();
            updateSummaries();
        }

        // Display Updates
        function updateBudgetDisplay() {
            const availableEl = document.getElementById('available-points');
            availableEl.textContent = saveData.remainingPoints;
            availableEl.className = 'budget-value' + (saveData.remainingPoints === 0 ? ' zero' : '');
            document.getElementById('total-points').textContent = saveData.totalSkillPoints;
            document.getElementById('spent-points').textContent = saveData.spentPoints;
        }

        function updateSummaries() {
            const passiveList = document.getElementById('passive-list');
            const reactionList = document.getElementById('reaction-list');
            passiveList.innerHTML = '';
            reactionList.innerHTML = '';

            let hasPassive = false;
            let hasReaction = false;

            function processSkillLevel(skillId, level, source) {
                const skillInfo = GAME_DATA.skillInfo[skillId];
                if (!skillInfo || !skillInfo.levels || !skillInfo.levels[level]) return;

                const levelData = skillInfo.levels[level];
                for (const ability of levelData) {
                    if (ability.type === 'passive') {
                        const div = document.createElement('div');
                        div.className = 'passive-item';
                        div.innerHTML = `<strong>${skillInfo.name} ${level}${source}:</strong> ${ability.desc}`;
                        passiveList.appendChild(div);
                        hasPassive = true;
                    } else if (ability.type === 'reaction') {
                        const div = document.createElement('div');
                        div.className = 'reaction-item';
                        div.innerHTML = `
                            <div class="reaction-trigger">
                                <span class="trigger-label">TRIGGER:</span> ${ability.trigger}
                            </div>
                            <div class="reaction-effect">
                                <strong>${skillInfo.name} ${level}${source}:</strong> ${ability.effect}
                            </div>
                        `;
                        reactionList.appendChild(div);
                        hasReaction = true;
                    }
                }
            }

            // Check inherent skills
            for (const [skillId, inherentLevel] of Object.entries(GAME_DATA.character.inherentSkills)) {
                for (let level = 1; level <= inherentLevel; level++) {
                    processSkillLevel(skillId, level, ' (Inherent)');
                }
            }

            // Check invested skills
            for (const [skillId, investment] of Object.entries(saveData.investments)) {
                const inherent = GAME_DATA.character.inherentSkills[skillId] || 0;
                const effectiveLevel = inherent + investment;

                for (let level = inherent + 1; level <= effectiveLevel; level++) {
                    processSkillLevel(skillId, level, '');
                }
            }

            document.getElementById('passive-empty').style.display = hasPassive ? 'none' : 'block';
            document.getElementById('reaction-empty').style.display = hasReaction ? 'none' : 'block';
        }

        function renderSkillGrid() {
            const grid = document.getElementById('skill-grid');
            grid.innerHTML = '';

            const classSkills = GAME_DATA.classes[currentClass].skills;
            const renderedSkills = new Set();

            for (const [skillId, classMax] of Object.entries(classSkills)) {
                renderSkillCard(skillId);
                renderedSkills.add(skillId);
            }

            for (const skillId of Object.keys(GAME_DATA.character.inherentSkills)) {
                if (!renderedSkills.has(skillId)) {
                    renderSkillCard(skillId);
                }
            }
        }

        function renderSkillCard(skillId) {
            const grid = document.getElementById('skill-grid');
            let card = document.getElementById(`card-${skillId}`);

            const inherent = GAME_DATA.character.inherentSkills[skillId] || 0;
            const investment = saveData.investments[skillId] || 0;
            const effectiveLevel = inherent + investment;
            const classMax = GAME_DATA.classes[currentClass].skills[skillId] || 0;
            const maxInvestable = classMax > 0 ? Math.min(3, classMax) - inherent : 0;
            const skillInfo = GAME_DATA.skillInfo[skillId];

            if (!card) {
                card = document.createElement('div');
                card.id = `card-${skillId}`;
                card.className = 'skill-card';
                grid.appendChild(card);
            }

            const isMaxed = investment >= maxInvestable && maxInvestable > 0;
            card.className = 'skill-card' + (effectiveLevel === 0 ? ' inactive' : '') + (isMaxed ? ' max-level' : '');

            card.innerHTML = `
                <div class="skill-header">
                    <div>
                        <h3 class="skill-name">${skillInfo.name}</h3>
                        <div class="skill-category">${skillInfo.category}</div>
                    </div>
                    ${inherent > 0 ? `<span class="inherent-badge">Level ${inherent} FREE</span>` : ''}
                </div>

                ${maxInvestable > 0 ? `
                    <div class="investment-controls">
                        <button onclick="decrementSkill('${skillId}')" ${investment === 0 ? 'disabled' : ''}>‚àí</button>
                        <div class="investment-display">
                            <span class="investment-label">Invest</span>
                            <span class="investment-value">${investment}</span>
                            <span class="investment-max">/ ${maxInvestable} available</span>
                        </div>
                        <button onclick="incrementSkill('${skillId}')" ${investment >= maxInvestable ? 'disabled' : ''}>+</button>
                    </div>
                ` : ''}

                <div class="effective-level">
                    <span class="effective-label">Total Level:</span>
                    <span class="effective-value">${effectiveLevel}</span>
                    <span class="effective-max">/ ${classMax > 0 ? Math.min(3, classMax) : inherent} max</span>
                    ${classMax === 0 && inherent > 0 ? '<div style="font-size: 0.8em; color: #888; margin-top: 5px;">Inherent only (current class doesn\'t offer this skill)</div>' : ''}
                </div>

                <div class="skill-levels">
                    ${[1, 2, 3].map(level => {
                        const maxLevelToShow = classMax > 0 ? classMax : inherent;
                        if (level > maxLevelToShow) return '';
                        const isActive = level <= effectiveLevel;
                        const isFree = level <= inherent;
                        const levelData = skillInfo.levels && skillInfo.levels[level] ? skillInfo.levels[level] : [];

                        return `
                            <div class="skill-level ${isActive ? 'active' : ''}">
                                <span class="level-badge ${isFree ? 'free' : ''}">
                                    Level ${level}${isFree ? ' (FREE)' : ''}
                                </span>
                                ${levelData.map(ability => {
                                    if (ability.type === 'passive') {
                                        return `<p class="level-description"><strong>üîÆ Passive:</strong> ${ability.desc}</p>`;
                                    } else if (ability.type === 'reaction') {
                                        return `
                                            <div class="reaction-details">
                                                <div class="trigger"><strong>‚ö° Trigger:</strong> ${ability.trigger}</div>
                                                <div class="effect"><strong>Effect:</strong> ${ability.effect}</div>
                                            </div>
                                        `;
                                    } else {
                                        return `<p class="level-description">${ability.desc}</p>`;
                                    }
                                }).join('')}
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }
    </script>
</body>
</html>
